<div class="friendships-page">
  <h1>Manage Friends</h1>

  <div class="friendships-grid">
    <div class="card">
      <h2>Your Friends (<%= @friends.count %>)</h2>
      <% if @friends.any? %>
        <div class="friends-list">
          <% @friends.each do |friend| %>
            <div class="friend-item">
              <span class="friend-name"><%= friend.username %></span>
              <div class="friend-actions">
                <%= link_to "Send Notification", new_push_notification_path(friend_id: friend.id), class: "btn btn-primary btn-sm" %>
                <%= link_to "Remove", friendship_path(Friendship.find_by(user: current_user, friend: friend) || Friendship.find_by(user: friend, friend: current_user)), method: :delete, class: "btn btn-danger btn-sm", data: { confirm: "Are you sure?" } %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p>You don't have any friends yet.</p>
      <% end %>
    </div>

    <div class="card">
      <h2>Pending Friend Requests (<%= @pending_requests.count %>)</h2>
      <% if @pending_requests.any? %>
        <div class="requests-list">
          <% @pending_requests.each do |request| %>
            <div class="request-item">
              <span class="request-name"><%= request.user.username %></span>
              <div class="request-actions">
                <%= link_to "Accept", accept_friendship_path(request), method: :patch, class: "btn btn-success btn-sm" %>
                <%= link_to "Reject", reject_friendship_path(request), method: :patch, class: "btn btn-danger btn-sm" %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p>No pending friend requests.</p>
      <% end %>
    </div>

    <div class="card">
      <h2>Sent Friend Requests (<%= @sent_requests.count %>)</h2>
      <% if @sent_requests.any? %>
        <div class="requests-list">
          <% @sent_requests.each do |request| %>
            <div class="request-item">
              <span class="request-name"><%= request.friend.username %></span>
              <span class="request-status">Pending</span>
            </div>
          <% end %>
        </div>
      <% else %>
        <p>No sent friend requests.</p>
      <% end %>
    </div>

    <div class="card">
      <h2>Add New Friends</h2>
      <% if @users.any? %>
        <div class="users-list">
          <% @users.each do |user| %>
            <div class="user-item">
              <span class="user-name"><%= user.username %></span>
              <%= link_to "Add Friend", friendships_path(friend_id: user.id), method: :post, class: "btn btn-primary btn-sm" %>
            </div>
          <% end %>
        </div>
      <% else %>
        <p>No more users to add as friends.</p>
      <% end %>
    </div>
  </div>

  <div class="back-link">
    <%= link_to "Back to Dashboard", root_path, class: "btn btn-secondary" %>
  </div>
</div>
